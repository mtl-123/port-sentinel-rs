services:
  port-sentinel-rs:
    container_name: port-sentinel-rs
    build: .
    restart: unless-stopped

    volumes:
      - ./config.toml:/app/config.toml:ro
      - ./logs:/app/logs

    environment:
      - TZ=Asia/Shanghai
      # ðŸ”¹ ç¦ç”¨ Rust è¾“å‡ºç¼“å†²
      - RUST_LOG=info
      - RUST_BACKTRACE=0

    # ðŸ”¹ ä½¿ç”¨ stdbuf ç¦ç”¨ç¼“å†² + tee åŒè¾“å‡º
    command: >
      sh -c "
        mkdir -p /app/logs &&
        chmod 777 /app/logs &&
        stdbuf -oL -eL ./port-sentinel-rs 2>&1 | tee -a /app/logs/port-sentinel.log
      "

    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "3"
